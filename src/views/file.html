<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>파일업로드test</title>

  <style>
    a {
            text-decoration: none;
            color: black;
    }
    .header {
        width: calc(100% - 4rem);
        height: 5rem;
        padding: 0 2rem 0 2rem;
        display: flex;
        align-items: center;
        background-color: whitesmoke;
    }
    .headerTitle{
        font-size: 24px;
        margin-right: 2rem;
    }
    .headerHome{
        margin-right: 1rem;
    }
    .headerWrite{
        margin-right: 1rem;
    }
    .file-input {
      display: block;
      margin: 10px 0;
    }

    .submitBtn {
            background-color: rgb(194, 58, 58);
            border: none;
            border-radius: 5px;
            height: 2rem;
            width: 5rem;
            color: white;
            cursor: pointer;
        }
  </style>
  
</head>
<body>
  <header class="header">
    <div class="headerTitle">
        <a href="/">Todo App</a>
    </div>
    <div class="headerHome">
        <a href="/">Home</a>
    </div>
    <div class="headerWrite">
        <a href="/write">DB todo</a>
    </div>
    <div class="headerWrite">
        <a href="/store-file">file save</a>
    </div>
    <div class="headerWrite">
        <a href="/profile">profile</a>
    </div>
  </header>

  <main>
    <form action="/api/profile/postDB" method="post" enctype="multipart/form-data">
      <label for="name">프로필 닉네임</label>
      <input type="text" name="name" />
      <input type="file" accept="image/*" name="image" class="file-input"/>
      
      <button class="submitBtn">저장하기</button>
    </form>

    <div id="profile-container"></div>
  
  </main>

  <script>
    window.onload = () => {
      getDB();
    };

    function getDB() {
      fetch('/api/profile/getDB')
      .then(async(res) => {
        const result = await res.json();
        if (result.result) {
          const db_arr = result.data;
          console.log('db_arr: ', db_arr);

          const divContainer = document.querySelector('#profile-container');
          for (let i=0; i<db_arr.length; i++) {
            const divElement = document.createElement('div');
            divElement.textContent = `
              닉네임: ${db_arr[i].name}
            `
            const imgElement = document.createElement('img');
            imgElement.src = `images/${db_arr[i].filename}`;
            console.log('imgElement.src: ', imgElement.src);
            imgElement.width = 200;
            imgElement.height = 200;
            imgElement.style = 'display: block';

            divElement.appendChild(imgElement);
            divContainer.appendChild(divElement);
          }

        } else {
          console.log('err');
        }
      })
      .catch((err) => console.log(err))
    }
    
  </script>

</body>
</html>